from = 2, to = 1,
edge_aes = DiagrammeR::edge_aes(
color = edge_clrs[2],
fontcolor = edge_clrs[2],
label = c(tm[2,1]),
penwidth = tm[2,1]
)) |>
DiagrammeR::add_edge(
from = 1, to = 1,
edge_aes = DiagrammeR::edge_aes(
color = edge_clrs[3],
fontcolor =  edge_clrs[3],
label = c(tm[1,1]),
penwidth = tm[1,1]
)) |>
DiagrammeR::add_edge(
from = 2, to = 2,
edge_aes = DiagrammeR::edge_aes(
label = c(tm[2,2]),
penwidth = tm[2,2],
color = edge_clrs[4],
fontcolor =  edge_clrs[4]
))
DiagrammeR::export_graph(
a_graph,
...,
title = x[['REG_NAME']][1],
file_name = file.path(
'..', 'results', 'Plots', 'MarkovChain',
paste0(gsub(' ', '_', x[['REG_NAME']][1]), '.png'))
)
}
lapply(output,
dia_wrapper, node_clrs = node_clrs, edge_clrs = edge_clrs,
file_type = 'PNG', width = 400, height = 140)
library(markovchain)
library(tidyverse)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
source('functions.R')
annual <- read.csv('../data/processed/NoFires-TotalArea_byDOIRegion.csv')
annual <- filter(annual, FIRE_YEAR  > 1998)
annual <- split(annual, f = annual$REG_NAME)
x <- classifyPtsMarkov(ann_cgb, colname = 'TotalArea_Acre', w = 1, type = 'g')
library(markovchain)
library(tidyverse)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
source('functions.R')
annual <- read.csv('../data/processed/NoFires-TotalArea_byDOIRegion.csv')
annual <- filter(annual, FIRE_YEAR  > 1998)
annual <- split(annual, f = annual$REG_NAME)
x <- classifyPtsMarkov(ann_cgb, colname = 'TotalArea_Acre', w = 1, type = 'g')
output <- lapply(annual, classifyPtsMarkov, w = 1, colname = 'TotalArea_Acre' )
node_clrs <- c('#4A001F', '#62BEC1')
edge_clrs <- c('#F5CDA7', '#2E0219', '#F50066', '#C5E7E8')
lapply(output,
dia_wrapper, node_clrs = node_clrs, edge_clrs = edge_clrs,
file_type = 'PNG', width = 400, height = 140)
png_files <- list.files(
'../results/Plots/MarkovChain',
pattern = "png$", full.names = TRUE
)
gifski::gifski(
png_files,
gif_file = '~/Documents/assoRted/SeedMarketSizingTalk/images/MarkovChains.gif',
delay = 2)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
source('functions.R')
library(terra)
library(tidyverse)
library(sf)
p2dat <- file.path('..', 'data', 'geospatial', 'FirePerimeters')
fire_perim <- st_read(
file.path(p2dat, list.files(p2dat, pattern = 'shp$')), quiet = TRUE) |>
mutate(FIRE_YEAR = as.numeric(FIRE_YEAR)) |>
filter(FIRE_YEAR >= 1990) |> # we are mostly interested in the trend since 95, but some few year
# rolling averages may be worth having.
filter(
FEATURE_CA == 'Wildfire Final Fire Perimeter', FIRE_YEAR != 9999) |>
select(OBJECTID, FIRE_YEAR, INCIDENT) |>
st_transform(4326) |> # was in pseudo-mercator !!! no no
st_make_valid()
## Join the relevant DOI region to the fire
p2dat <- file.path('..', 'data', 'geospatial', 'DOIRegions')
regions <- st_read(
file.path(p2dat, list.files(p2dat, pattern = 'shp$')), quiet = TRUE) |>
select(REG_NAME) |>
sf::st_transform(st_crs(fire_perim))
firesYear <- read.csv(file.path('..', 'data', 'processed', 'NoFires-TotalArea_byDOIRegion.csv'))
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
firesYear <- read.csv(file.path('..', 'data', 'processed', 'NoFires-TotalArea_byDOIRegion.csv'))
library(tidyverse)
library(quantreg)
View(firesYear)
firesYear <- read.csv(file.path('..', 'data', 'processed', 'NoFires-TotalArea_byDOIRegion.csv')) |>
filter(REG_NAME == 'Columbia-Pacific Northwest'))
firesYear <- read.csv(file.path('..', 'data', 'processed', 'NoFires-TotalArea_byDOIRegion.csv')) |>
filter(REG_NAME == 'Columbia-Pacific Northwest')
model <- rq(FIRE_YEAR ~ NoFIRE, data = firesYear, tau = 0.5)
model <- rq(FIRE_YEAR ~ TOTALarea_Acre, data = firesYear, tau = 0.5)
model <- rq(FIRE_YEAR ~ TotalArea_Acre, data = firesYear, tau = 0.5)
model
ggplot(firesYear, aes(TotalArea_Acre, FIRE_YEAR)) +
geom_point() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_point() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
model <- rq(FIRE_YEAR ~ TotalArea_Acre, data = firesYear, tau = 0.5)
model
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_point() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
model <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_point() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
model5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
model <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.25)
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.25 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.25)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
library(tidyverse)
library(quantreg)
firesYear <- read.csv(file.path('..', 'data', 'processed', 'NoFires-TotalArea_byDOIRegion.csv')) |>
filter(REG_NAME == 'Columbia-Pacific Northwest')
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.25 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.25)
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model)[1], slope=coef(model)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2]) +
geom_abline(intercept=coef(model.25)[1], slope=coef(model.25)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2]) +
geom_abline(intercept=coef(model.25)[1], slope=coef(model.25)[2], color = 'purple')
model.75 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.25)
model.75 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.75)
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2]) +
geom_abline(intercept=coef(model.25)[1], slope=coef(model.25)[2], color = 'purple') +
geom_abline(intercept=coef(model.75)[1], slope=coef(model.75)[2], color = 'purple')
lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear,)
model.lm <- lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear,)
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2]) +
geom_abline(intercept=coef(model.25)[1], slope=coef(model.25)[2], color = 'purple') +
geom_abline(intercept=coef(model.75)[1], slope=coef(model.75)[2], color = 'purple') +
geom_abline(intercept=coef(model.lm)[1], slope=coef(model.lm)[2])
ggplot(firesYear, aes(FIRE_YEAR, TotalArea_Acre)) +
geom_line() +
geom_abline(intercept=coef(model.5)[1], slope=coef(model.5)[2]) +
geom_abline(intercept=coef(model.25)[1], slope=coef(model.25)[2], color = 'purple') +
geom_abline(intercept=coef(model.75)[1], slope=coef(model.75)[2], color = 'purple') +
geom_abline(intercept=coef(model.lm)[1], slope=coef(model.lm)[2], color = 'red')
png(p)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['roll']], lty = 3, col = 'grey30')
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey20')
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
model.4 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.4)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
model.7 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.7)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.7)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
model.lm <- lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear)
model.4 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.4)
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
model.7 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.7)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.7)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
library(tidyverse)
library(quantreg)
firesYear <- read.csv(file.path('..', 'data', 'processed',
'NoFires-TotalArea_byDOIRegion.csv')) |>
filter(REG_NAME == 'Columbia-Pacific Northwest')
model.lm <- lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear)
model.4 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.4)
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
model.65 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.65)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.65)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.65)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
model.lm <- lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear)
model.4 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.4)
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
model.65 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.65)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.65)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
setwd('~/Documents/assoRted/EstimatingSeedMarketSize/scripts')
library(tidyverse)
library(quantreg)
firesYear <- read.csv(file.path('..', 'data', 'processed',
'NoFires-TotalArea_byDOIRegion.csv')) |>
filter(REG_NAME == 'Columbia-Pacific Northwest')
model.lm <- lm(TotalArea_Acre ~ FIRE_YEAR, data = firesYear)
model.4 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.4)
model.5 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.5)
model.6 <- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.6)
model.625<- rq(TotalArea_Acre ~ FIRE_YEAR, data = firesYear, tau = 0.625)
par(mar = c(7, 5, 4, 2))
plot(
x = firesYear$FIRE_YEAR,
y = firesYear$TotalArea_Acre,
main = paste0('Total Area Burned - and possibly treated\n', firesYear[['REG_NAME']][1]),
xlab = 'Fire Year',
ylab = 'Total Area (Acre)',
pch = 20,
cex = 1.2,
yaxt = "n"
)
lines(firesYear[['FIRE_YEAR']], firesYear[['TotalArea_Acre']], lty = 3, col = 'grey30')
abline(model.lm, col = 'grey60')
abline(model.5)
abline(model.4)
abline(model.6)
abline(model.625)
axis(2,
at = labs <- pretty(par()$usr[3:4]),
labels = prettyNum(
labs, big.mark = ",", scientific = FALSE)
)
