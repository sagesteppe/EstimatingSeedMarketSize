---
title: "Tabulate Terrestrial Areas by DOI Region"
author: "Reed Clark Benkendorf"
date: "2025-01-27"
output: pdf_document
---

To estimate the amount of native seed required by each Department of Interior (DOI) region via the simulations several constants are required. 
These constants largely reflect the amount of terrestrial area per DOI region, and how these surfaces are allocated between administrative agencies. 
These calculations are performed in this document these values are then utilized for all subsequent analyses and products. 

Here we calculate the following values,
1) The sum of terrestrial area administered by each DOI agency
2) The sum of terrestrial area administered in each DOI region  
3) The sum of terrestrial area administered by each DOI agency in each DOI region 
4) The sum of National Land Cover Data (NLCD) classes, on DOI agency administered land by DOI region
5) The sum of NLCD classes by each DOI agency by DOI region

```{r load libraries}
library(tidyverse)
library(terra)
library(sf)
```

# 1, 2, & 3 Total sums of terrestrial area managed by DOI agencies

```{r Import Data}
p <- file.path('..', 'data', 'geospatial', 'DOIadministered', 'DOIterrestrial.gpkg')
padus <- st_read(file.path(p), quiet = TRUE) |>
  # we are dealing with areas over significant curvature of the earth
  # and many high latitude areas so will need to calculate our areas on 
  # the geoid
  sf::st_transform(4326) |>
  sf::st_make_valid()

p <- file.path('..', 'data', 'geospatial', 'AdministrativeUnits', 'DOIRegions', 'DOI_12_Unified_Regions_20180801.shp')
regions <- st_read(file.path(p), quiet = TRUE) |>
  sf::st_transform(4326) |>
  sf::st_make_valid()
```

The sum of terrestrial area administered by each DOI agency can be calculated by simply summing over the entire PADUS data set, which we have subset to the relevant agencies. 

```{r terrestrial land by agency}

indx <- sf::st_is_valid(padus)
which(indx == FALSE)
plot(padus[1800,1])

OB <- st_collection_extract(padus[which(indx == FALSE),], 'POLYGON')
OB <- st_make_valid(OB)

OBCast <- st_cast(OB, 'POLYGON')
st_is_valid(OBCast)
OBCast <- st_union(OBCast) 

bind_cols(
  st_drop_geometry(OB), 
  geometry = OBCast
)

st_is_valid()

areas_rough <- data.frame(
  areas = units::set_units(sf::st_area(padus), ha),
  agency = padus$Mang_Name
) |>
  group_by(agency) |>
  summarise(Total_area = as.numeric(sum(areas)*2.471051565))

areas_rough
```

```{r terrestrial land by doi region}

```


```{r land by doi region x agency}

```

